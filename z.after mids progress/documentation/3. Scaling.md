```python
python3 scaling.py 
/home/kay/Documents/Workspace-S25/SE/SeProject/APT DETECTION/z.after mids progress/processing/New Approach by HH/scaling.py:17: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
  df[numeric_cols] = df[numeric_cols].applymap(lambda x: max(x, 0) if pd.notnull(x) else x)
üéâ Scaling completed successfully. Summary of changes:

üîÅ Replaced 121348 negative values with 0 in numeric columns.
üßπ Removed 64 infinity values by dropping rows containing them.
üìè Applied Min-Max scaling to numeric columns: ['Destination Port', 'Flow Duration', 'Total Fwd Packets', 'Total Backward Packets', 'Total Length of Fwd Packets', 'Total Length of Bwd Packets', 'Fwd Packet Length Max', 'Fwd Packet Length Min', 'Fwd Packet Length Mean', 'Fwd Packet Length Std', 'Bwd Packet Length Max', 'Bwd Packet Length Min', 'Bwd Packet Length Mean', 'Bwd Packet Length Std', 'Flow Bytes/s', 'Flow Packets/s', 'Flow IAT Mean', 'Flow IAT Std', 'Flow IAT Max', 'Flow IAT Min', 'Fwd IAT Total', 'Fwd IAT Mean', 'Fwd IAT Std', 'Fwd IAT Max', 'Fwd IAT Min', 'Bwd IAT Total', 'Bwd IAT Mean', 'Bwd IAT Std', 'Bwd IAT Max', 'Bwd IAT Min', 'Fwd PSH Flags', 'Fwd Header Length', 'Bwd Header Length', 'Fwd Packets/s', 'Bwd Packets/s', 'Min Packet Length', 'Max Packet Length', 'Packet Length Mean', 'Packet Length Std', 'Packet Length Variance', 'SYN Flag Count', 'PSH Flag Count', 'ACK Flag Count', 'URG Flag Count', 'Down/Up Ratio', 'Average Packet Size', 'Avg Fwd Segment Size', 'Avg Bwd Segment Size', 'Fwd Header Length.1', 'Subflow Fwd Packets', 'Subflow Fwd Bytes', 'Subflow Bwd Packets', 'Subflow Bwd Bytes', 'Init_Win_bytes_forward', 'Init_Win_bytes_backward', 'act_data_pkt_fwd', 'min_seg_size_forward', 'Active Mean', 'Active Std', 'Active Max', 'Active Min', 'Idle Mean', 'Idle Std', 'Idle Max', 'Idle Min', 'Label']
üî¢ Rounded scaled values to 4 decimal places.
üíæ Saved the cleaned and scaled dataset to 'dataset_scaled.csv'
(myenv) 
```

```python
# SCRIPT:
import pandas as pd
from sklearn.preprocessing import MinMaxScaler
import numpy as np

# Step 1: Load the dataset
input_file = "dataset_after_low_variance_removed.csv"
df = pd.read_csv(input_file)

# Step 2: Create a log for changes
log = []

# Step 3: Replace negative values with 0 (only in numeric columns)
numeric_cols = df.select_dtypes(include=['int64', 'float64']).columns

neg_val_count = (df[numeric_cols] < 0).sum().sum()
if neg_val_count > 0:
    df[numeric_cols] = df[numeric_cols].applymap(lambda x: max(x, 0) if pd.notnull(x) else x)
    log.append(f"üîÅ Replaced {neg_val_count} negative values with 0 in numeric columns.")
else:
    log.append("‚úÖ No negative values found.")

# Step 4: Replace inf/-inf with NaN and drop them
inf_count = np.isinf(df[numeric_cols].values).sum()
if inf_count > 0:
    df[numeric_cols] = df[numeric_cols].replace([np.inf, -np.inf], np.nan)
    df.dropna(subset=numeric_cols, inplace=True)
    log.append(f"üßπ Removed {inf_count} infinity values by dropping rows containing them.")
else:
    log.append("‚úÖ No infinity values found.")

# Step 5: Apply Min-Max Scaling to numeric columns
scaler = MinMaxScaler()
df[numeric_cols] = scaler.fit_transform(df[numeric_cols])
log.append(f"üìè Applied Min-Max scaling to numeric columns: {list(numeric_cols)}")

# Step 6: Round the scaled values to 4 decimal places
df[numeric_cols] = df[numeric_cols].round(4)
log.append("üî¢ Rounded scaled values to 4 decimal places.")

# Step 7: Save the scaled dataset
output_file = "dataset_scaled.csv"
df.to_csv(output_file, index=False)
log.append(f"üíæ Saved the cleaned and scaled dataset to '{output_file}'")

# Step 8: Save a change log
log_file = "scaling_log.txt"
with open(log_file, "w") as f:
    f.write("\n".join(log))

print("üéâ Scaling completed successfully. Summary of changes:\n")
print("\n".join(log))
```

## --> Problem was last script changed many many vals to zero and it ruined the dataset 
## --> Changing the script to shift the negative vals

```python
‚ÜïÔ∏è Shifted column 'Flow Duration' to make values non-negative (min was -1)
‚ÜïÔ∏è Shifted column 'Flow Bytes/s' to make values non-negative (min was -12000000.0)
‚ÜïÔ∏è Shifted column 'Flow Packets/s' to make values non-negative (min was -2000000.0)
‚ÜïÔ∏è Shifted column 'Flow IAT Mean' to make values non-negative (min was -1.0)
‚ÜïÔ∏è Shifted column 'Flow IAT Max' to make values non-negative (min was -1)
‚ÜïÔ∏è Shifted column 'Flow IAT Min' to make values non-negative (min was -12)
‚ÜïÔ∏è Shifted column 'Fwd IAT Min' to make values non-negative (min was -12)
‚ÜïÔ∏è Shifted column 'Init_Win_bytes_forward' to make values non-negative (min was -1)
‚ÜïÔ∏è Shifted column 'Init_Win_bytes_backward' to make values non-negative (min was -1)
üßπ Removed 64 infinity values by dropping rows containing them.
üìè Applied Min-Max scaling to numeric columns: ['Destination Port', 'Flow Duration', 'Total Fwd Packets', 'Total Backward Packets', 'Total Length of Fwd Packets', 'Total Length of Bwd Packets', 'Fwd Packet Length Max', 'Fwd Packet Length Min', 'Fwd Packet Length Mean', 'Fwd Packet Length Std', 'Bwd Packet Length Max', 'Bwd Packet Length Min', 'Bwd Packet Length Mean', 'Bwd Packet Length Std', 'Flow Bytes/s', 'Flow Packets/s', 'Flow IAT Mean', 'Flow IAT Std', 'Flow IAT Max', 'Flow IAT Min', 'Fwd IAT Total', 'Fwd IAT Mean', 'Fwd IAT Std', 'Fwd IAT Max', 'Fwd IAT Min', 'Bwd IAT Total', 'Bwd IAT Mean', 'Bwd IAT Std', 'Bwd IAT Max', 'Bwd IAT Min', 'Fwd PSH Flags', 'Fwd Header Length', 'Bwd Header Length', 'Fwd Packets/s', 'Bwd Packets/s', 'Min Packet Length', 'Max Packet Length', 'Packet Length Mean', 'Packet Length Std', 'Packet Length Variance', 'SYN Flag Count', 'PSH Flag Count', 'ACK Flag Count', 'URG Flag Count', 'Down/Up Ratio', 'Average Packet Size', 'Avg Fwd Segment Size', 'Avg Bwd Segment Size', 'Fwd Header Length.1', 'Subflow Fwd Packets', 'Subflow Fwd Bytes', 'Subflow Bwd Packets', 'Subflow Bwd Bytes', 'Init_Win_bytes_forward', 'Init_Win_bytes_backward', 'act_data_pkt_fwd', 'min_seg_size_forward', 'Active Mean', 'Active Std', 'Active Max', 'Active Min', 'Idle Mean', 'Idle Std', 'Idle Max', 'Idle Min', 'Label']
üî¢ Rounded scaled values to 4 decimal places.
üíæ Saved the cleaned and scaled dataset to 'dataset_scaled.csv'
```

```python 
#scripts
import pandas as pd
from sklearn.preprocessing import MinMaxScaler
import numpy as np

# Step 1: Load the dataset
input_file = "dataset_after_low_variance_removed.csv"
df = pd.read_csv(input_file)

# Step 2: Create a log for changes
log = []

# Step 3: Shift negative values to make them non-negative
numeric_cols = df.select_dtypes(include=['int64', 'float64']).columns
shift_log = []

for col in numeric_cols:
    min_val = df[col].min()
    if pd.notnull(min_val) and min_val < 0:
        df[col] = df[col] + abs(min_val)
        shift_log.append(f"  ‚û§ Column '{col}': shifted by +{abs(min_val)}")
        log.append(f"‚ÜïÔ∏è Shifted column '{col}' to make values non-negative (min was {min_val})")

if not shift_log:
    log.append("‚úÖ No negative values found to shift.")

# Step 4: Replace inf/-inf with NaN and drop them
inf_count = np.isinf(df[numeric_cols].values).sum()
if inf_count > 0:
    df[numeric_cols] = df[numeric_cols].replace([np.inf, -np.inf], np.nan)
    df.dropna(subset=numeric_cols, inplace=True)
    log.append(f"üßπ Removed {inf_count} infinity values by dropping rows containing them.")
else:
    log.append("‚úÖ No infinity values found.")

# Step 5: Apply Min-Max Scaling to numeric columns
scaler = MinMaxScaler()
df[numeric_cols] = scaler.fit_transform(df[numeric_cols])
log.append(f"üìè Applied Min-Max scaling to numeric columns: {list(numeric_cols)}")

# Step 6: Round the scaled values to 4 decimal places
df[numeric_cols] = df[numeric_cols].round(4)
log.append("üî¢ Rounded scaled values to 4 decimal places.")

# Step 7: Save the scaled dataset
output_file = "dataset_scaled.csv"
df.to_csv(output_file, index=False)
log.append(f"üíæ Saved the cleaned and scaled dataset to '{output_file}'")

# Step 8: Save a change log
log_file = "scaling_log.txt"
with open(log_file, "w") as f:
    f.write("\n".join(log))

# Step 9: Display summary
print("üéâ Scaling completed successfully. Summary of changes:\n")
print("\n".join(log))

```

![[Pasted image 20250328222924.png]]
$python3 4.dataleakage.py 

Top 10 Most Correlated Features with Label:
 Label                      1.000000
 Init_Win_bytes_backward    0.260389
 PSH Flag Count             0.183899
Init_Win_bytes_forward      0.179898
 Down/Up Ratio              0.131244
 min_seg_size_forward       0.115060
 Min Packet Length          0.095790
 Bwd Packet Length Min      0.084897
 Fwd Packet Length Min      0.068071
 Fwd IAT Std                0.063815
Name:  Label, dtype: float64
```python
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# Load dataset
file_path = "/home/kay/Documents/Workspace-S25/SE/SeProject/APT DETECTION/z.after mids progress/dataset/Thursday-WorkingHours-Morning-WebAttacks.pcap_ISCX.csv"
df = pd.read_csv(file_path)

# Ensure the 'Label' column is numeric (1 = Attack, 0 = Benign)
df[" Label"] = df[" Label"].astype(int)

# Compute correlation matrix with absolute values 
correlation_matrix = df.corr().abs()

# Sort correlations of all features with 'Label'
label_correlation = correlation_matrix[" Label"].sort_values(ascending=False)

# Print the top 10 most correlated features
print("Top 10 Most Correlated Features with Label:")
print(label_correlation.head(10))

# Visualizing the correlation heatmap
plt.figure(figsize=(12, 6))
sns.heatmap(correlation_matrix, cmap="coolwarm", annot=False)
plt.title("Feature Correlation Heatmap")
plt.show()

#---------------------------------------------------------------
```

new scriptttt

```python
import pandas as pd

import seaborn as sns

import matplotlib.pyplot as plt

  

# Load dataset

file_path = "/home/kay/Documents/Workspace-S25/SE/SeProject/APT DETECTION/z.after mids progress/dataset/Thursday-WorkingHours-Morning-WebAttacks.pcap_ISCX.csv"

df = pd.read_csv(file_path)

  
  

# Ensure the 'Label' column is numeric (1 = Attack, 0 = Benign)

df["Label"] = df["Label"].astype(int)

  

# Compute correlation matrix with absolute values

correlation_matrix = df.corr().abs()

  

# Sort correlations of all features with 'Label'

label_correlation = correlation_matrix["Label"].sort_values(ascending=False)

  

# Print the top 10 most correlated features

print("Top 10 Most Correlated Features with Label:")

print(label_correlation.head(10))

  

# Visualizing the correlation heatmap

plt.figure(figsize=(12, 6))

sns.heatmap(correlation_matrix, cmap="coolwarm", annot=False)

plt.title("Feature Correlation Heatmap")

plt.show()

  

#-----------------------------Dropping----------------------------------

  

# Dropping highly correlated features (if any > 0.9)

correlation_threshold = 0.1

leaky_features = label_correlation[label_correlation > correlation_threshold].index.tolist()

  

# Remove 'Label' from this list (we need it)

leaky_features.remove("Label")

  

print(f"Dropping potentially leaky features: {leaky_features}")

df_cleaned = df.drop(columns=leaky_features)

  

# Save cleaned dataset

  

df_cleaned.to_csv(file_path, index=False)

print(f"Cleaned dataset saved to {file_path}")

  
  

#------------------checking remaining---------------

k =0

for i in df_cleaned.columns:

print(f"{k}, {i} ")

k +=1
```

Top 10 Most Correlated Features with Label:
Label                      1.000000
Init_Win_bytes_backward    0.260389
PSH Flag Count             0.183899
Init_Win_bytes_forward     0.179898
Down/Up Ratio              0.131244
min_seg_size_forward       0.115060
Min Packet Length          0.095790
Bwd Packet Length Min      0.084897
Fwd Packet Length Min      0.068071
Fwd IAT Std                0.063815
Name: Label, dtype: float64
Dropping potentially leaky features: ['Init_Win_bytes_backward', 'PSH Flag Count', 'Init_Win_bytes_forward', 'Down/Up Ratio', 'min_seg_size_forward']
Cleaned dataset saved to /home/kay/Documents/Workspace-S25/SE/SeProject/APT DETECTION/z.after mids progress/dataset/Thursday-WorkingHours-Morning-WebAttacks.pcap_ISCX.csv
0, Destination Port 
1, Flow Duration 
2, Total Fwd Packets 
3, Total Backward Packets 
4, Total Length of Fwd Packets 
5, Total Length of Bwd Packets 
6, Fwd Packet Length Max 
7, Fwd Packet Length Min 
8, Fwd Packet Length Mean 
9, Fwd Packet Length Std 
10, Bwd Packet Length Max 
11, Bwd Packet Length Min 
12, Bwd Packet Length Mean 
13, Bwd Packet Length Std 
14, Flow Bytes/s 
15, Flow Packets/s 
16, Flow IAT Mean 
17, Flow IAT Std 
18, Flow IAT Max 
19, Flow IAT Min 
20, Fwd IAT Total 
21, Fwd IAT Mean 
22, Fwd IAT Std 
23, Fwd IAT Max 
24, Fwd IAT Min 
25, Bwd IAT Total 
26, Bwd IAT Mean 
27, Bwd IAT Std 
28, Bwd IAT Max 
29, Bwd IAT Min 
30, Fwd PSH Flags 
31, Bwd PSH Flags 
32, Fwd URG Flags 
33, Bwd URG Flags 
34, Fwd Header Length 
35, Bwd Header Length 
36, Fwd Packets/s 
37, Bwd Packets/s 
38, Min Packet Length 
39, Max Packet Length 
40, Packet Length Mean 
41, Packet Length Std 
42, Packet Length Variance 
43, FIN Flag Count 
44, SYN Flag Count 
45, RST Flag Count 
46, ACK Flag Count 
47, URG Flag Count 
48, CWE Flag Count 
49, ECE Flag Count 
50, Average Packet Size 
51, Avg Fwd Segment Size 
52, Avg Bwd Segment Size 
53, Fwd Header Length.1 
54, Fwd Avg Bytes/Bulk 
55, Fwd Avg Packets/Bulk 
56, Fwd Avg Bulk Rate 
57, Bwd Avg Bytes/Bulk 
58, Bwd Avg Packets/Bulk 
59, Bwd Avg Bulk Rate 
60, Subflow Fwd Packets 
61, Subflow Fwd Bytes 
62, Subflow Bwd Packets 
63, Subflow Bwd Bytes 
64, act_data_pkt_fwd 
65, Active Mean 
66, Active Std 
67, Active Max 
68, Active Min 
69, Idle Mean 
70, Idle Std 
71, Idle Max 
72, Idle Min 
73, Label